<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="midiblender">
<title>Mangling with Matrices • midiblender</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Mangling with Matrices">
<meta property="og:description" content="midiblender">
<meta property="og:image" content="https://crumplab.com/midiblender/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-C7SNDLCKT8"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-C7SNDLCKT8');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">midiblender</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Getting_started.html">Getting started with MIDI mangling in R</a>
    <a class="dropdown-item" href="../articles/midi_construct.html">Midi data frame constructors with dplyr</a>
    <a class="dropdown-item" href="../articles/mangling_with_matrices.html">Mangling with Matrices</a>
    <a class="dropdown-item" href="../articles/midi_mangle.html">Basic MIDI mangling functions</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/CrumpLab/midiblender">
    <span class="fa fa-lg fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Mangling with Matrices</h1>
                        <h4 data-toc-skip class="author">Matt Crump</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CrumpLab/midiblender/tree/main/vignettes/mangling_with_matrices.Rmd" class="external-link"><code>vignettes/mangling_with_matrices.Rmd</code></a></small>
      <div class="d-none name"><code>mangling_with_matrices.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">midiblender</span><span class="op">)</span></span></code></pre></div>
<p>{midiblender} is an experimental package for mangling MIDI for
various outcomes. I’ve been posting different experiments on my <a href="https://homophony.quest/notes.html" class="external-link">music blog</a>, which has more
examples.</p>
<p>The examples work right now (2/8/24), but will they blend in the
future? Maybe.</p>
<p>The importing functions that call python packages through future
deprecation warnings. C’est la vie.</p>
<div class="section level2">
<h2 id="basic-example-probabilistic-mario">Basic Example: Probabilistic Mario<a class="anchor" aria-label="anchor" href="#basic-example-probabilistic-mario"></a>
</h2>
<p>This example imports MIDI fromthe overworld theme song from Super
Mario brothers. {midiblender} is used to represent the MIDI file in a
feature vector and matrix format. For example, one bar of music could be
coded as a matrix with 128 rows for each possible note, and 96*4 columns
for all of the midi time ticks in 4 beats of a 4/4 bar. Note_on messages
are coded as 1s in their respective positions in the matrix. The
approach ignores note_off entirely, so all notes will have the same
length in the end. Every other cell is given a 0.</p>
<p>The midi file is sliced up into bars (or any temporal interval), and
each slice is converted to the matrix representation. The matrix for
each slice is further concatenated into a long feature vector. The
resulting matrix can be used to compute note and time probabilities.
These probabilities are then used to generate new sequences, and
exported as a midi file.</p>
<p>I go into more conceptual detail in <a href="https://homophony.quest/blog/37_2_5_24_matrix_analysis/" class="external-link">this blog
post</a>.</p>
<div class="section level3">
<h3 id="import-midi">import midi<a class="anchor" aria-label="anchor" href="#import-midi"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mario</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/midi_to_object.html">midi_to_object</a></span><span class="op">(</span><span class="st">"all_overworld.mid"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list2env.html" class="external-link">list2env</a></span><span class="op">(</span><span class="va">mario</span>, <span class="va">.GlobalEnv</span><span class="op">)</span> <span class="co"># unpack the contents to global environment</span></span>
<span><span class="co">#&gt; &lt;environment: R_GlobalEnv&gt;</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="transform">transform<a class="anchor" aria-label="anchor" href="#transform"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make a copy of the midi_df object containing the desired track</span></span>
<span><span class="va">track_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/copy_midi_df_track.html">copy_midi_df_track</a></span><span class="op">(</span>midi_df <span class="op">=</span> <span class="va">midi_df</span>,track_num <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make another copy of midi_df that will be extended with</span></span>
<span><span class="co"># additional timing information across columns</span></span>
<span><span class="va">copy_track</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/copy_and_extend_midi_df.html">copy_and_extend_midi_df</a></span><span class="op">(</span>midi_df <span class="op">=</span> <span class="va">midi_df</span>,</span>
<span>                                      track_num <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a new tibble to keep track of some musical intervals</span></span>
<span><span class="va">metric_tibble</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_metric_tibble.html">make_metric_tibble</a></span><span class="op">(</span></span>
<span>  <span class="va">copy_track</span>,</span>
<span>  bars <span class="op">=</span> <span class="fl">48</span>,</span>
<span>  smallest_tick <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  ticks_per_beat <span class="op">=</span> <span class="fl">96</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add the timing info to the copy</span></span>
<span><span class="va">copy_track</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_bars_to_copy_df.html">add_bars_to_copy_df</a></span><span class="op">(</span><span class="va">copy_track</span>, <span class="va">metric_tibble</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert the df to matrix representation</span></span>
<span><span class="va">music_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_midi_matrix.html">create_midi_matrix</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">copy_track</span>,</span>
<span>  num_notes <span class="op">=</span> <span class="fl">128</span>,</span>
<span>  intervals_per_bar <span class="op">=</span> <span class="fl">48</span>,</span>
<span>  separate <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="probability">probability<a class="anchor" aria-label="anchor" href="#probability"></a>
</h3>
<p>This section calculates probabilities from the matrix representation
and generates new sequences based on the probabilities.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get the probability of each note in time</span></span>
<span><span class="co"># from the whole matrix</span></span>
<span><span class="va">feature_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_feature_probs.html">get_feature_probs</a></span><span class="op">(</span>midi_matrix <span class="op">=</span> <span class="va">music_matrix</span><span class="op">$</span><span class="va">pitch_by_time_matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate the average number of notes per row in the matrix</span></span>
<span><span class="co"># useful to set the density parameter next</span></span>
<span><span class="va">mean_note_density</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_mean_note_density.html">get_mean_note_density</a></span><span class="op">(</span>midi_matrix <span class="op">=</span> <span class="va">music_matrix</span><span class="op">$</span><span class="va">pitch_by_time_matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate new sequences from the probability vector</span></span>
<span><span class="co"># basically a wrapper to rbinom()</span></span>
<span><span class="va">new_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_features_from_probs.html">new_features_from_probs</a></span><span class="op">(</span>probs <span class="op">=</span> <span class="va">feature_probs</span>,</span>
<span>                                        density <span class="op">=</span> <span class="va">mean_note_density</span>,</span>
<span>                                        examples <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#convert the new sequences to a piano roll style matrix</span></span>
<span><span class="va">new_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/feature_vector_to_matrix.html">feature_vector_to_matrix</a></span><span class="op">(</span>vec <span class="op">=</span> <span class="va">new_features</span>,</span>
<span>                                       num_notes <span class="op">=</span> <span class="fl">128</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="transform-out">transform out<a class="anchor" aria-label="anchor" href="#transform-out"></a>
</h3>
<p>The next steps involve converting the matrix representation back into
a midi dataframe.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># convert the matrix into a dataframe</span></span>
<span><span class="va">midi_time_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matrix_to_midi_time.html">matrix_to_midi_time</a></span><span class="op">(</span>midi_matrix <span class="op">=</span> <span class="va">new_matrix</span>,</span>
<span>                                    smallest_time_unit <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                                    note_off_length <span class="op">=</span> <span class="fl">32</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># grab the meta messages from this copy</span></span>
<span><span class="va">meta_messages_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_midi_meta_df.html">get_midi_meta_df</a></span><span class="op">(</span><span class="va">track_0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set the tempo message (it was missing in this case)</span></span>
<span><span class="va">meta_messages_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_midi_tempo_meta.html">set_midi_tempo_meta</a></span><span class="op">(</span><span class="va">meta_messages_df</span>,update_tempo <span class="op">=</span> <span class="fl">500000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># split the meta messages into top and end</span></span>
<span><span class="va">split_meta_messages_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/split_meta_df.html">split_meta_df</a></span><span class="op">(</span><span class="va">meta_messages_df</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># compile the valid MIDI dataframe</span></span>
<span><span class="va">new_midi_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matrix_to_midi_track.html">matrix_to_midi_track</a></span><span class="op">(</span>midi_time_df <span class="op">=</span> <span class="va">midi_time_df</span>,</span>
<span>                                    split_meta_list <span class="op">=</span> <span class="va">split_meta_messages_df</span>,</span>
<span>                                    channel <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                    velocity <span class="op">=</span> <span class="fl">64</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># update miditapyr df</span></span>
<span><span class="va">miditapyr_object</span><span class="op">$</span><span class="va">midi_frame_unnested</span><span class="op">$</span><span class="fu">update_unnested_mf</span><span class="op">(</span><span class="va">new_midi_df</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#write midi file to disk</span></span>
<span><span class="va">miditapyr_object</span><span class="op">$</span><span class="fu">write_file</span><span class="op">(</span><span class="st">"prob_mario.mid"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="export-to-mp3">export to mp3<a class="anchor" aria-label="anchor" href="#export-to-mp3"></a>
</h3>
<p>I would use a script like this to bounce the midi file to mp3 with
fluidsynth and a nintendo sound font.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#########</span></span>
<span><span class="co"># bounce to mp3 with fluid synth</span></span>
<span></span>
<span><span class="va">track_name</span> <span class="op">&lt;-</span> <span class="st">"prob_mario"</span></span>
<span></span>
<span><span class="va">wav_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">track_name</span>,<span class="st">".wav"</span><span class="op">)</span></span>
<span><span class="va">midi_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">track_name</span>,<span class="st">".mid"</span><span class="op">)</span></span>
<span><span class="va">mp3_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">track_name</span>,<span class="st">".mp3"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># synthesize midi file to wav with fluid synth</span></span>
<span><span class="va">system_command</span> <span class="op">&lt;-</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">'fluidsynth -F {wav_name} ~/Library/Audio/Sounds/Banks/nintendo_soundfont.sf2 {midi_name}'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="va">system_command</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert wav to mp3</span></span>
<span><span class="fu">av</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/av/reference/encoding.html" class="external-link">av_audio_convert</a></span><span class="op">(</span><span class="va">wav_name</span>,<span class="va">mp3_name</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># clean up and delete wav</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">wav_name</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="va">wav_name</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><audio controls=""><source src="prob_mario.mp3" type="audio/wav"></source></audio></p>
</div>
</div>
<div class="section level2">
<h2 id="matrix-transforms">Matrix transforms<a class="anchor" aria-label="anchor" href="#matrix-transforms"></a>
</h2>
<p>These are some handy helper functions for getting MIDI into a
matrix.</p>
<div class="section level3">
<h3 id="midi_df_to_matrix">midi_df_to_matrix()<a class="anchor" aria-label="anchor" href="#midi_df_to_matrix"></a>
</h3>
<p>This function takes a data frame obtained from a MIDI file and
converts it to a binary matrix representation, with time frames
(absolute midi ticks) as columns and MIDI note numbers (0-127) as
rows.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># import midi</span></span>
<span><span class="va">mario</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/midi_to_object.html">midi_to_object</a></span><span class="op">(</span><span class="st">"all_overworld.mid"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list2env.html" class="external-link">list2env</a></span><span class="op">(</span><span class="va">mario</span>, <span class="va">.GlobalEnv</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;environment: R_GlobalEnv&gt;</span></span>
<span></span>
<span><span class="co"># convert whole track to a big piano roll style matrix</span></span>
<span><span class="va">piano_roll_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/midi_df_to_matrix.html">midi_df_to_matrix</a></span><span class="op">(</span>midi_df<span class="op">=</span> <span class="va">midi_df</span>,</span>
<span>                                       track <span class="op">=</span> <span class="fl">0</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">piano_roll_matrix</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]   128 14113</span></span></code></pre></div>
<p>The mario MIDI file lasts for a total of of 14113 midi ticks. If
memory serves, this file is set as 96 ticks per beat. The matrix has 128
rows for each possible note, and 14113 for each possible midi time tick.
The note values at each time tick are represented as 1s in the
matrix.</p>
</div>
<div class="section level3">
<h3 id="reshape_piano_roll">reshape_piano_roll()<a class="anchor" aria-label="anchor" href="#reshape_piano_roll"></a>
</h3>
<p>This function reshapes a piano_roll matrix into a matrix of
concatenated feature vectors for each time slice. For example, splitting
the matrix into slices of 2 beats would entail slicing up the matrix
every 96*2 = 192 ticks. Each sliced matrix is then concatenated into a
single long feature vector, and all feature vectors are placed in a new
matrix.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">two_beats_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reshape_piano_roll.html">reshape_piano_roll</a></span><span class="op">(</span><span class="va">piano_roll_matrix</span>,</span>
<span>                                       ticks_per_interval <span class="op">=</span> <span class="op">(</span><span class="fl">96</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This is a convenient way to quickly reshape the matrix for the
purpose of calculating note in time probabilities for the new shape,
like so:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feature_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">two_beats_matrix</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">two_beats_matrix</span><span class="op">)</span></span></code></pre></div>
<p>Different shapes yield different probabilities, which have different
“musical” results on later sequences generated from those
probabilities.</p>
</div>
</div>
<div class="section level2">
<h2 id="other-examples">Other examples<a class="anchor" aria-label="anchor" href="#other-examples"></a>
</h2>
<p>For the foreseeable future I’m inclined to keep posting new examples
and experiments with MIDI mangling on my <a href="https://homophony.quest/notes.html" class="external-link">music blog</a>. Given the
fluid state of the code, I’m not sure how reproducible the examples will
be later on, so perhaps it is better to keep the exploratory stuff over
there.</p>
<ul>
<li><a href="https://homophony.quest/blog/33_2_1_24_rand_mario/" class="external-link">Systematically
randomizing Super Mario brothers with R</a></li>
<li><a href="https://homophony.quest/blog/35_2_3_24_matrix_midi/" class="external-link">Midi
to matrix representation and probabilistic super mario music with
R</a></li>
<li><a href="https://homophony.quest/blog/37_2_5_24_matrix_analysis/" class="external-link">MIDI
analysis, bags of notes, and probabilistic generation</a></li>
<li><a href="https://homophony.quest/blog/39_2_7_24_midiblender_mario/" class="external-link">WIP:
Endless probabilistically generated mario music with
midiblender</a></li>
<li><a href="https://homophony.quest/blog/40_2_7_24_midiblender_canon/" class="external-link">Midi
blending Canon in D probabilistically</a></li>
</ul>
<p>As the code base becomes more solid, I’ll attempt to document
interesting examples in other vignettes.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matthew J. C. Crump.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
