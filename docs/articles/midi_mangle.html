<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="midiblender">
<title>Basic MIDI mangling functions • midiblender</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Basic MIDI mangling functions">
<meta property="og:description" content="midiblender">
<meta property="og:image" content="https://crumplab.com/midiblender/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-C7SNDLCKT8"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-C7SNDLCKT8');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">midiblender</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9002</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Getting_started.html">Getting started with MIDI mangling in R</a>
    <a class="dropdown-item" href="../articles/midi_construct.html">Midi data frame constructors with dplyr</a>
    <a class="dropdown-item" href="../articles/mangling_with_matrices.html">Mangling with Matrices</a>
    <a class="dropdown-item" href="../articles/midi_mangle.html">Basic MIDI mangling functions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/CrumpLab/midiblender">
    <span class="fa fa-lg fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Basic MIDI mangling functions</h1>
                        <h4 data-toc-skip class="author">Matt Crump</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CrumpLab/midiblender/tree/main/vignettes/midi_mangle.Rmd" class="external-link"><code>vignettes/midi_mangle.Rmd</code></a></small>
      <div class="d-none name"><code>midi_mangle.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">midiblender</span><span class="op">)</span></span></code></pre></div>
<p>A collection of tools for mangling basic aspects of midi files.</p>
<div class="section level2">
<h2 id="mangle_note_wiggler">mangle_note_wiggler()<a class="anchor" aria-label="anchor" href="#mangle_note_wiggler"></a>
</h2>
<p>This might be a bit unstable, but it’s a goodie. The
<code>semitones</code> input takes a vector of positive semitone values.
These are used to randomly offset every note up or down by the values in
the vector. The <code>keep_same</code> input is an integer that pads the
sampling vector with 0s. During the sampling process, a random value
from the vector is chosen to add to a note value. If the chosen value is
0, then the note is not changed.</p>
<p>notes: this function was way more involved than I expected. Will
probably need to be refactored at some point, and may not be very
tolerant of different kinds of midi files.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># import midi</span></span>
<span><span class="va">mario</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/midi_to_object.html">midi_to_object</a></span><span class="op">(</span><span class="st">"all_overworld.mid"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list2env.html" class="external-link">list2env</a></span><span class="op">(</span><span class="va">mario</span>, <span class="va">.GlobalEnv</span><span class="op">)</span></span>
<span></span>
<span><span class="va">midi_df</span> <span class="op">&lt;-</span> <span class="fu">midiblender</span><span class="fu">::</span><span class="fu"><a href="../reference/set_midi_tempo_midi_df.html">set_midi_tempo_midi_df</a></span><span class="op">(</span><span class="va">midi_df</span><span class="op">)</span></span>
<span></span>
<span><span class="va">copy_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mangle_note_wiggler.html">mangle_note_wiggler</a></span><span class="op">(</span><span class="va">midi_df</span>, semitones <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">7</span><span class="op">)</span>, keep_same <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># update miditapyr df</span></span>
<span><span class="va">miditapyr_object</span><span class="op">$</span><span class="va">midi_frame_unnested</span><span class="op">$</span><span class="fu">update_unnested_mf</span><span class="op">(</span><span class="va">copy_df</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#write midi file to disk</span></span>
<span><span class="va">miditapyr_object</span><span class="op">$</span><span class="fu">write_file</span><span class="op">(</span><span class="st">"note_wiggler_mario.mid"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="mangle_positive_timing">mangle_positive_timing()<a class="anchor" aria-label="anchor" href="#mangle_positive_timing"></a>
</h2>
<p>Add/subtract random ticks to the time column from a uniform
distribution. Set the range of the distribution with
<code>ticks_amount</code> to control the amount of jitter. Any resulting
time values that are negative are set to zero. This function does not
add jitter to spread out simultaneous messages, so chords do not become
jittered triads.</p>
<p>Useful for subtle humanization, or to absolutely wreck the timing
information.</p>
<p>Notes: This function was written to work in a dplyr pipe. It might be
nice to hide that part inside the function so this can be run directly
on the df…not sure yet, maybe both.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># import midi</span></span>
<span><span class="va">mario</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/midi_to_object.html">midi_to_object</a></span><span class="op">(</span><span class="st">"all_overworld.mid"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list2env.html" class="external-link">list2env</a></span><span class="op">(</span><span class="va">mario</span>, <span class="va">.GlobalEnv</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># a dplyr pipe to apply jitter non-meta messages</span></span>
<span><span class="va">midi_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">meta</span> <span class="op">==</span> <span class="cn">FALSE</span> <span class="op">~</span> <span class="fu"><a href="../reference/mangle_positive_timing.html">mangle_positive_timing</a></span><span class="op">(</span><span class="va">time</span>, ticks_amount <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>    <span class="va">meta</span> <span class="op">==</span> <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">time</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">copy_df</span></span>
<span></span>
<span><span class="co"># update miditapyr df</span></span>
<span><span class="va">miditapyr_object</span><span class="op">$</span><span class="va">midi_frame_unnested</span><span class="op">$</span><span class="fu">update_unnested_mf</span><span class="op">(</span><span class="va">copy_df</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#write midi file to disk</span></span>
<span><span class="va">miditapyr_object</span><span class="op">$</span><span class="fu">write_file</span><span class="op">(</span><span class="st">"jitter_mario.mid"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="mangle_transpose">mangle_transpose()<a class="anchor" aria-label="anchor" href="#mangle_transpose"></a>
</h2>
<p>Transpose all notes up or down by semitones.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># import midi</span></span>
<span><span class="va">mario</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/midi_to_object.html">midi_to_object</a></span><span class="op">(</span><span class="st">"all_overworld.mid"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list2env.html" class="external-link">list2env</a></span><span class="op">(</span><span class="va">mario</span>, <span class="va">.GlobalEnv</span><span class="op">)</span></span>
<span></span>
<span><span class="va">copy_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mangle_transpose.html">mangle_transpose</a></span><span class="op">(</span><span class="va">midi_df</span>, <span class="op">-</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># update miditapyr df</span></span>
<span><span class="va">miditapyr_object</span><span class="op">$</span><span class="va">midi_frame_unnested</span><span class="op">$</span><span class="fu">update_unnested_mf</span><span class="op">(</span><span class="va">copy_df</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#write midi file to disk</span></span>
<span><span class="va">miditapyr_object</span><span class="op">$</span><span class="fu">write_file</span><span class="op">(</span><span class="st">"transpose_mario.mid"</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matthew J. C. Crump.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
